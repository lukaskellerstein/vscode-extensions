# 1.4 Extension Manifest Deep Dive

## Introduction

The `package.json` file is the heart of your extension. It's not just a package manifest - it's where you declare all the capabilities, contributions, and configuration of your extension. This lesson covers every important aspect of this file.

## Basic Metadata

### Required Fields

```json
{
  "name": "my-extension",
  "publisher": "your-publisher-name",
  "version": "1.0.0",
  "engines": {
    "vscode": "^1.85.0"
  }
}
```

**name**: Must be lowercase, no spaces, URL-safe
**publisher**: Your publisher ID from the marketplace
**version**: Semantic versioning (major.minor.patch)
**engines.vscode**: Minimum VS Code version

### Display Fields

```json
{
  "displayName": "My Amazing Extension",
  "description": "Does amazing things in VS Code",
  "categories": ["Other"],
  "keywords": ["productivity", "tools", "helpers"],
  "icon": "images/icon.png",
  "galleryBanner": {
    "color": "#C80000",
    "theme": "dark"
  }
}
```

**displayName**: Human-readable name (shown in marketplace)
**description**: Brief description (< 200 chars)
**categories**: Classification for marketplace
**keywords**: Search terms
**icon**: 128x128 PNG icon
**galleryBanner**: Marketplace banner styling

### Available Categories

```json
{
  "categories": [
    "Programming Languages",
    "Snippets",
    "Linters",
    "Themes",
    "Debuggers",
    "Formatters",
    "Keymaps",
    "SCM Providers",
    "Other",
    "Extension Packs",
    "Language Packs",
    "Data Science",
    "Machine Learning",
    "Visualization",
    "Notebooks",
    "Education",
    "Testing"
  ]
}
```

## Activation Events

Activation events determine when your extension loads. Choose wisely for performance!

### Command Activation

```json
{
  "activationEvents": [
    "onCommand:extension.commandName"
  ]
}
```

Extension activates when command is invoked.

### Language Activation

```json
{
  "activationEvents": [
    "onLanguage:javascript",
    "onLanguage:typescript",
    "onLanguage:python"
  ]
}
```

Extension activates when file of specified language is opened.

### File Type Activation

```json
{
  "activationEvents": [
    "onFileSystem:sftp",
    "onFileSystem:ssh"
  ]
}
```

Activates when file system scheme is used.

### View Activation

```json
{
  "activationEvents": [
    "onView:myExtension.explorerView"
  ]
}
```

Activates when view is expanded.

### Workspace Contains

```json
{
  "activationEvents": [
    "workspaceContains:**/.eslintrc.json",
    "workspaceContains:**/package.json"
  ]
}
```

Activates when workspace contains matching file(s).

### URI Activation

```json
{
  "activationEvents": [
    "onUri"
  ]
}
```

Activates when URI is opened (e.g., `vscode://publisher.extension/...`).

### Debug Activation

```json
{
  "activationEvents": [
    "onDebug",
    "onDebugInitialConfigurations",
    "onDebugResolve:node"
  ]
}
```

### Task Activation

```json
{
  "activationEvents": [
    "onTaskType:npm",
    "onTaskType:gulp"
  ]
}
```

### Custom Activation

```json
{
  "activationEvents": [
    "onCustomEditor:catCustoms.pawDraw",
    "onAuthenticationRequest:github"
  ]
}
```

### Startup Activation (Use Sparingly!)

```json
{
  "activationEvents": [
    "*"
  ]
}
```

⚠️ **Warning**: Activates on VS Code startup. Use only when absolutely necessary!

### Modern Approach: No activationEvents

Since VS Code 1.74, you can omit `activationEvents` entirely! Commands, views, and other contributions automatically register their activation events.

```json
{
  "contributes": {
    "commands": [
      {
        "command": "extension.hello",
        "title": "Hello"
      }
    ]
  }
  // No activationEvents needed!
}
```

## Contribution Points

Contributions are how your extension adds functionality to VS Code.

### Commands

```json
{
  "contributes": {
    "commands": [
      {
        "command": "extension.doSomething",
        "title": "Do Something",
        "category": "My Extension",
        "icon": {
          "light": "resources/light/icon.svg",
          "dark": "resources/dark/icon.svg"
        },
        "enablement": "editorTextFocus"
      }
    ]
  }
}
```

**command**: Unique identifier
**title**: Display name
**category**: Groups commands in palette
**icon**: Optional icon (for toolbar)
**enablement**: When clause for enabling

### Menus

```json
{
  "contributes": {
    "menus": {
      "commandPalette": [
        {
          "command": "extension.doSomething",
          "when": "editorTextFocus"
        }
      ],
      "editor/context": [
        {
          "command": "extension.doSomething",
          "when": "editorHasSelection",
          "group": "navigation"
        }
      ],
      "editor/title": [
        {
          "command": "extension.doSomething",
          "when": "resourceLangId == javascript",
          "group": "navigation"
        }
      ],
      "explorer/context": [
        {
          "command": "extension.doSomething",
          "when": "resourceExtname == .js",
          "group": "2_workspace"
        }
      ],
      "view/title": [
        {
          "command": "extension.refreshView",
          "when": "view == myExtension.view",
          "group": "navigation"
        }
      ],
      "view/item/context": [
        {
          "command": "extension.itemAction",
          "when": "view == myExtension.view && viewItem == type1",
          "group": "inline"
        }
      ]
    }
  }
}
```

### Keybindings

```json
{
  "contributes": {
    "keybindings": [
      {
        "command": "extension.doSomething",
        "key": "ctrl+shift+t",
        "mac": "cmd+shift+t",
        "when": "editorTextFocus"
      }
    ]
  }
}
```

### Configuration

```json
{
  "contributes": {
    "configuration": {
      "title": "My Extension",
      "properties": {
        "myExtension.enable": {
          "type": "boolean",
          "default": true,
          "description": "Enable my extension"
        },
        "myExtension.maxItems": {
          "type": "number",
          "default": 10,
          "minimum": 1,
          "maximum": 100,
          "description": "Maximum number of items"
        },
        "myExtension.outputFormat": {
          "type": "string",
          "default": "json",
          "enum": ["json", "xml", "yaml"],
          "enumDescriptions": [
            "JSON format",
            "XML format",
            "YAML format"
          ],
          "description": "Output format"
        },
        "myExtension.paths": {
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          },
          "description": "List of paths"
        },
        "myExtension.advanced": {
          "type": "object",
          "properties": {
            "timeout": {
              "type": "number",
              "default": 5000
            },
            "retries": {
              "type": "number",
              "default": 3
            }
          },
          "default": {
            "timeout": 5000,
            "retries": 3
          },
          "description": "Advanced settings"
        }
      }
    }
  }
}
```

### Views

```json
{
  "contributes": {
    "views": {
      "explorer": [
        {
          "id": "myExtension.view",
          "name": "My View",
          "icon": "resources/view-icon.svg",
          "contextualTitle": "My Extension View",
          "visibility": "visible"
        }
      ]
    },
    "viewsContainers": {
      "activitybar": [
        {
          "id": "myExtension-container",
          "title": "My Extension",
          "icon": "resources/container-icon.svg"
        }
      ]
    }
  }
}
```

### View Containers (Sidebar Locations)

```json
{
  "contributes": {
    "viewsContainers": {
      "activitybar": [...],  // Activity bar (left side)
      "panel": [...]          // Panel (bottom)
    }
  }
}
```

### Languages

```json
{
  "contributes": {
    "languages": [
      {
        "id": "mylang",
        "aliases": ["MyLanguage", "mylang"],
        "extensions": [".mylang", ".ml"],
        "configuration": "./language-configuration.json",
        "icon": {
          "light": "./icons/mylang-light.png",
          "dark": "./icons/mylang-dark.png"
        }
      }
    ]
  }
}
```

### Grammars (Syntax Highlighting)

```json
{
  "contributes": {
    "grammars": [
      {
        "language": "mylang",
        "scopeName": "source.mylang",
        "path": "./syntaxes/mylang.tmLanguage.json"
      }
    ]
  }
}
```

### Themes

```json
{
  "contributes": {
    "themes": [
      {
        "label": "My Dark Theme",
        "uiTheme": "vs-dark",
        "path": "./themes/dark-theme.json"
      },
      {
        "label": "My Light Theme",
        "uiTheme": "vs",
        "path": "./themes/light-theme.json"
      }
    ],
    "iconThemes": [
      {
        "id": "myIcons",
        "label": "My Icon Theme",
        "path": "./icons/icon-theme.json"
      }
    ]
  }
}
```

### Snippets

```json
{
  "contributes": {
    "snippets": [
      {
        "language": "javascript",
        "path": "./snippets/javascript.json"
      },
      {
        "language": "typescript",
        "path": "./snippets/typescript.json"
      }
    ]
  }
}
```

### Debuggers

```json
{
  "contributes": {
    "debuggers": [
      {
        "type": "node",
        "label": "Node Debug",
        "program": "./out/debugAdapter.js",
        "runtime": "node",
        "configurationAttributes": {
          "launch": {
            "required": ["program"],
            "properties": {
              "program": {
                "type": "string",
                "description": "Absolute path to the program",
                "default": "${workspaceFolder}/index.js"
              }
            }
          }
        },
        "initialConfigurations": [
          {
            "type": "node",
            "request": "launch",
            "name": "Launch Program",
            "program": "${workspaceFolder}/index.js"
          }
        ]
      }
    ]
  }
}
```

### Task Providers

```json
{
  "contributes": {
    "taskDefinitions": [
      {
        "type": "mytask",
        "required": ["task"],
        "properties": {
          "task": {
            "type": "string",
            "description": "The task to execute"
          },
          "file": {
            "type": "string",
            "description": "The file to process"
          }
        }
      }
    ]
  }
}
```

### Problem Matchers

```json
{
  "contributes": {
    "problemMatchers": [
      {
        "name": "mycompiler",
        "owner": "mylanguage",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
          "file": 1,
          "line": 2,
          "column": 3,
          "severity": 4,
          "message": 5
        }
      }
    ]
  }
}
```

### Product Icon Themes

```json
{
  "contributes": {
    "productIconThemes": [
      {
        "id": "elegant",
        "label": "Elegant",
        "path": "./product-icon-theme.json"
      }
    ]
  }
}
```

## Dependencies

### Extension Dependencies

```json
{
  "extensionDependencies": [
    "publisher.other-extension"
  ]
}
```

Your extension depends on another extension being installed.

### Extension Pack

```json
{
  "extensionPack": [
    "publisher.extension1",
    "publisher.extension2"
  ]
}
```

Bundle multiple extensions together.

### Extension Kind

```json
{
  "extensionKind": [
    "ui",
    "workspace"
  ]
}
```

**ui**: Runs in local VS Code
**workspace**: Runs in remote workspace
Array order indicates preference

## Scripts

Common npm scripts for extension development:

```json
{
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "pretest": "npm run compile && npm run lint",
    "lint": "eslint src --ext ts",
    "test": "vscode-test",
    "package": "vsce package",
    "publish": "vsce publish"
  }
}
```

## Complete Example

Here's a comprehensive example combining many features:

```json
{
  "name": "awesome-extension",
  "displayName": "Awesome Extension",
  "description": "An awesome extension for VS Code",
  "version": "1.0.0",
  "publisher": "myname",
  "author": {
    "name": "Your Name",
    "email": "your@email.com"
  },
  "license": "MIT",
  "icon": "images/icon.png",
  "galleryBanner": {
    "color": "#C80000",
    "theme": "dark"
  },
  "categories": ["Other", "Productivity"],
  "keywords": ["awesome", "productivity"],
  "engines": {
    "vscode": "^1.85.0"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/username/awesome-extension"
  },
  "bugs": {
    "url": "https://github.com/username/awesome-extension/issues"
  },
  "homepage": "https://github.com/username/awesome-extension#readme",
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "awesome.start",
        "title": "Start",
        "category": "Awesome",
        "icon": "$(play)"
      }
    ],
    "menus": {
      "commandPalette": [
        {
          "command": "awesome.start",
          "when": "workspaceFolderCount > 0"
        }
      ],
      "editor/title": [
        {
          "command": "awesome.start",
          "when": "resourceLangId == javascript",
          "group": "navigation"
        }
      ]
    },
    "keybindings": [
      {
        "command": "awesome.start",
        "key": "ctrl+alt+a",
        "mac": "cmd+alt+a",
        "when": "editorTextFocus"
      }
    ],
    "configuration": {
      "title": "Awesome Extension",
      "properties": {
        "awesome.enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable Awesome Extension"
        }
      }
    },
    "views": {
      "explorer": [
        {
          "id": "awesome.treeView",
          "name": "Awesome View"
        }
      ]
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "lint": "eslint src --ext ts"
  },
  "devDependencies": {
    "@types/vscode": "^1.85.0",
    "@types/node": "18.x",
    "typescript": "^5.3.2",
    "eslint": "^8.54.0"
  }
}
```

## Best Practices

### 1. Minimize Activation Events
Only activate when necessary for best performance.

### 2. Use Categories Appropriately
Choose the most relevant category for marketplace discovery.

### 3. Provide Good Metadata
- Clear, concise description
- Relevant keywords
- Professional icon
- Complete README

### 4. Version Properly
Follow semantic versioning:
- **MAJOR**: Breaking changes
- **MINOR**: New features (backward compatible)
- **PATCH**: Bug fixes

### 5. Document Configuration
Provide clear descriptions for all settings.

### 6. Use When Clauses
Conditionally show/enable commands based on context.

## Summary

You've learned:

- ✅ All required and optional manifest fields
- ✅ Activation events and when to use them
- ✅ All major contribution points
- ✅ How to configure commands, menus, and keybindings
- ✅ Extension configuration options
- ✅ Views and view containers
- ✅ Dependencies and extension packs
- ✅ Best practices for manifest files

## Exercise

Create a manifest for an extension that:
1. Provides commands for TODO management
2. Has a tree view in the explorer
3. Activates only when a workspace contains TODO files
4. Has configuration for TODO patterns
5. Provides keybindings for adding TODOs
6. Shows in the editor title bar for text files

## Next Steps

You've completed Module 1! Proceed to [Module 2: Core Concepts](../../module-02-core-concepts/README.md) to learn about commands, configuration, and UI elements.

## Additional Resources

- [Extension Manifest Reference](https://code.visualstudio.com/api/references/extension-manifest)
- [Contribution Points](https://code.visualstudio.com/api/references/contribution-points)
- [When Clause Contexts](https://code.visualstudio.com/api/references/when-clause-contexts)
- [Activation Events](https://code.visualstudio.com/api/references/activation-events)
